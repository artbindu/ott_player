/**************************************************************************** 
 * Copyright (C) 2022, Bitmovin, Inc., All Rights Reserved 
 * 
 * This source code and its use and distribution, is subject to the terms 
 * and conditions of the applicable license agreement. 
 * 
 * Bitmovin Player Version 8.90.0 
 * 
 ****************************************************************************/
(function() {
"use strict";!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.mserenderer=t():(e.bitmovin=e.bitmovin||{},e.bitmovin.player=e.bitmovin.player||{},e.bitmovin.player.mserenderer=t())}(self,(function(){return(self.webpackChunkbitmovin_player_name_=self.webpackChunkbitmovin_player_name_||[]).push([[766],{92024:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.BufferMimeCodecMap=void 0;var n=r(82556),i=r(22221),o=r(45366),s=r(11917),u=r(82072),a=r(50163),d=function(){function e(e,t){this.mimeCodeMap={},this.store=e,this.settings=t}return e.prototype.ensureMetricsForMimeType=function(e){var t,r,s=null===(t=this.store)||void 0===t?void 0:t.getState();(0,n.isInstanceState)(s)&&c(this.settings)&&((0,o.getMetricsState)(s)[e]||null===(r=this.store)||void 0===r||r.dispatch((0,i.initializeMetricsForMimeType)(e,this.settings)))},e.prototype.removeMetrics=function(e){var t;null===(t=this.store)||void 0===t||t.dispatch((0,i.removeMetricsForMimeType)(e))},e.prototype.add=function(e,t){var r;this.mimeCodeMap[e]=t,this.ensureMetricsForMimeType(e),null===(r=this.store)||void 0===r||r.dispatch((0,i.addMetricsValue)(e,s.MetricType.StalledSeconds,0))},e.prototype.remove=function(e){var t=this,r=a.MimeTypeHelper.getMediaType(e);Object.keys(this.mimeCodeMap).forEach((function(e){a.MimeTypeHelper.getMediaType(e)===r&&(t.removeMetrics(e),delete t.mimeCodeMap[e])}))},e.prototype.has=function(e,t){var r=this,n=a.MimeTypeHelper.getMediaType(e),i=a.MimeTypeHelper.extractContainerType(e);return Object.keys(this.mimeCodeMap).some((function(o){var s=a.MimeTypeHelper.getMediaType(o),u=a.MimeTypeHelper.extractContainerType(o);return s===n&&u===i&&t===r.mimeCodeMap[e]}))},e.prototype.update=function(e,t){this.remove(e),this.add(e,t)},e.prototype.forEach=function(e){var t=this;Object.keys(this.entries()).forEach((function(r){return e(r,t.entries()[r])}))},e.prototype.entries=function(){return this.mimeCodeMap},e.prototype.dispose=function(){this.mimeCodeMap={},this.store=void 0,this.settings=void 0},e}();t.BufferMimeCodecMap=d;var c=function(e){return(0,u.isObject)(e)}},86943:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.GapHandler=void 0;var n=r(59574),i=r(82556),o=r(59536),s=r(15949),u=r(89543),a=r(30111),d=r(91689),c=[u.MediaElementEvent.seeking,u.MediaElementEvent.seeked,u.MediaElementEvent.pause,u.MediaElementEvent.playing,u.MediaElementEvent.error],f=5,h=10,p=250,l=.01,m=function(){function e(e){var t,r,s,a,f=this;this.checkIfWaiting=function(){f.context.isDisposed||!f.video||f.video.paused||f.video.seeking&&!f.isAtEndOfBufferedRange(f.video.currentTime)||f.lastTimeupdate&&!(Date.now()-f.lastTimeupdate>1e3)||(f.consecutiveWaiting++,f.waiting())},this.waiting=function(){var e,t=f.context.store.getState();if((0,i.isInstanceState)(t)&&f.video){var r=(0,o.getPlayerState)(t);((0,o.getIsSeeking)(r)||(null===(e=f.video)||void 0===e?void 0:e.seeking))&&!f.isAtEndOfBufferedRange(f.video.currentTime)||f.setTimer()}},this.stalled=function(){f.setTimer()},this.onSeek=function(){f.gapAhead=void 0},this.timeupdate=function(){if(f.lastTimeupdate=Date.now(),f.video&&!f.video.paused&&!f.video.seeking){f.hasPlayedAnythingYet=!0;var e=f.video.currentTime;if(f.shouldSkipGap(e))return f.skipGap(),void(f.gapAhead=void 0);var t=f.video.buffered;t.length>1&&!f.gapAhead?f.gapAhead=y(t,e):f.shouldTriggerWaitingEvent(e)?(f.consecutiveUpdates++,f.waiting()):e===f.lastRecordedTime?f.consecutiveUpdates++:(f.consecutiveUpdates=0,f.consecutiveWaiting=0,f.lastRecordedTime=e)}},this.cancelTimer=function(){f.consecutiveUpdates=0,f.consecutiveWaiting=0,clearTimeout(f.timer),f.timer=-1},this.skipTheGap=function(e){if(f.video){var t=f.video.buffered,r=f.video.currentTime,n=d.Ranges.findNextRange(t,r);f.consecutiveUpdates=0,f.consecutiveWaiting=0,f.timer=-1,0!==n.length&&r===e&&(f.context.logger.debug("skipTheGap: currentTime: "+r+" scheduled currentTime: "+e+" nextRange start: "+n.start(0)),f.setCurrentTime(n.start(0)+d.Ranges.TIME_FUDGE_FACTOR))}},this.onPlaying=function(){f.hasPlayedAnythingYet=!0,f.context.eventHandler.off(n.PlayerEvent.Playing,f.onPlaying)},this.context=e,this.video=e.videoElement,this.consecutiveUpdates=0,this.consecutiveWaiting=0,this.hasPlayedAnythingYet=!1,this.gapAhead=void 0,null===(t=this.video)||void 0===t||t.addEventListener(u.MediaElementEvent.waiting,this.waiting),null===(r=this.video)||void 0===r||r.addEventListener(u.MediaElementEvent.stalled,this.stalled),null===(s=this.video)||void 0===s||s.addEventListener(u.MediaElementEvent.timeupdate,this.timeupdate),this.context.eventHandler.on(n.PlayerEvent.Playing,this.onPlaying),this.context.eventHandler.on(n.PlayerEvent.Seek,this.onSeek);for(var h=0,l=c;h<l.length;h++){var m=l[h];null===(a=this.video)||void 0===a||a.addEventListener(m,this.cancelTimer)}this.timeupdateIntervalId=window.setInterval(this.checkIfWaiting,p)}return e.prototype.shouldSkipGap=function(e){return!!this.gapAhead&&(g(e,this.gapAhead)||v(this.context.settings.PROACTIVE_GAP_SKIP_DISTANCE_SECONDS,e,this.gapAhead))},e.prototype.shouldTriggerWaitingEvent=function(e){return this.consecutiveUpdates===f&&e===this.lastRecordedTime},e.prototype.skipGap=function(){if(this.video&&this.gapAhead){var e=this.video.currentTime,t=Math.max(e+l,this.gapAhead.end);this.setCurrentTime(t),this.context.logger.debug("jumped buffer gap from ".concat(e," to ").concat(t))}},e.prototype.gapFromVideoUnderflow=function(e,t){for(var r=d.Ranges.findGaps(e),n=0;n<r.length;n++){var i=r.start(n),o=r.end(n);if(t-i<4&&t-i>2)return{start:i,end:o}}},e.prototype.setTimer=function(){if(!(this.timer>-1)&&this.hasPlayedAnythingYet&&this.video){var e=this.video.buffered,t=this.video.currentTime,r=d.Ranges.findNextRange(e,t);if(0===r.length){var n=this.gapFromVideoUnderflow(e,t);if(n)return this.context.logger.debug("Encountered a gap in video from ".concat(n.start," to ").concat(n.end,". Seeking to ").concat(t,"...")),this.consecutiveWaiting=0,void this.setCurrentTime(t);var i=(0,a.findNextRangeForGap)(t,this.video.buffered),o=i.isNearEndOfBufferedRange,s=i.nextRangeStart;return o&&isFinite(s)?(this.context.logger.debug("Playback stalled because of a very small gap. Seeking to ".concat(s,"...")),this.consecutiveWaiting=0,void this.setCurrentTime(s)):void(this.consecutiveWaiting>h&&(this.consecutiveWaiting=0,this.triggerCurrentTimeNotAdvancing(t,this.video)))}var u=r.start(0)-t;this.context.logger.debug("setTimer: stopped at: "+t+", setting timer for:"+u+", seeking to:"+r.start(0)),this.timer=window.setTimeout(this.skipTheGap.bind(this),u,t)}},e.prototype.triggerCurrentTimeNotAdvancing=function(e,t){this.context.logger.debug("currentTime not advancing from ".concat(e," although the video element is neither paused nor seeking")),this.maybePokeVideoElement(e,t),t.eventHandler.triggerEvent(u.MediaElementEvent.currenttimenotadvancing)},e.prototype.maybePokeVideoElement=function(e,t){e>t.duration&&!(0,s.getCapabilities)().isSafari?this.setCurrentTime(t.duration):this.context.settings.QJY_BROWSER_WORKAROUND||(0,s.getCapabilities)().isTizen?this.setCurrentTime(e+l):this.setCurrentTime(e)},e.prototype.isAtEndOfBufferedRange=function(e){if(!this.video)return!1;for(var t=this.video.buffered,r=0;r<t.length;r++)if(t.end(r)===e)return!0;return!1},e.prototype.shutdown=function(){var e,t,r,i;null===(e=this.video)||void 0===e||e.removeEventListener(u.MediaElementEvent.waiting,this.waiting),null===(t=this.video)||void 0===t||t.removeEventListener(u.MediaElementEvent.stalled,this.stalled),null===(r=this.video)||void 0===r||r.removeEventListener(u.MediaElementEvent.timeupdate,this.timeupdate),this.context.eventHandler.off(n.PlayerEvent.Playing,this.onPlaying),this.context.eventHandler.off(n.PlayerEvent.Seek,this.onSeek);for(var o=0,s=c;o<s.length;o++){var a=s[o];null===(i=this.video)||void 0===i||i.removeEventListener(a,this.cancelTimer)}clearInterval(this.timeupdateIntervalId),this.cancelTimer()},e.prototype.setCurrentTime=function(e){if(this.video&&this.video.currentTime!==e)try{this.video.currentTime=e}catch(t){this.context.logger.debug("GapHandler failed to set currentTime on video element to "+e,t)}},e}();function g(e,t){return e>t.start}function v(e,t,r){return!(e<=0)&&(r.start>t&&r.start-e<t)}function y(e,t){for(var r=0;r<e.length-1;r++)if(e.end(r)>t)return{start:e.end(r),end:e.start(r+1)}}t.GapHandler=m},30111:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.findNextRangeForGap=void 0;var n=r(91689);function i(e,t){for(var r=!1,i=1/0,o=0;o<t.length;o++){var s=t.start(o),u=t.end(o),a=e+2*n.Ranges.TIME_FUDGE_FACTOR;if(r&&!isFinite(i)){i=s;break}s<e&&u>e&&a>u&&(r=!0)}return{isNearEndOfBufferedRange:r,nextRangeStart:i}}t.findNextRangeForGap=i},5526:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.MSERenderer=void 0;var n=r(45659),i=r(14809),o=r(36166),s=r(85739),u=r(59534),a=r(59574),d=r(8833),c=r(73882),f=r(38106),h=r(15949),p=r(82072),l=r(81028),m=r(50163),g=r(80815),v=r(89543),y=r(1520),S=r(86705),E=r(92024),T=r(86943),b=r(50022),P=r(88074),C=function(){function e(e){var t=this;this.context=e,this.consecutiveErrorCount=0,this.waitingForSeekedPromise=null,this.onSeek=function(e){t.setCurrentTimeDelayedContext&&t.setCurrentTimeDelayedContext.time!==e.seekTarget&&Math.abs(t.setCurrentTimeDelayedContext.time-e.seekTarget)>=t.context.settings.GAP_TOLERANCE&&t.cancelSetCurrentTimeDelayed(e.seekTarget)},this.onPeriodSwitch=function(){t.periodSwitchOngoing=!0},this.onPeriodSwitched=function(){t.periodSwitchOngoing=!1},this.reOpenMse=function(){var e=t.segmentQueueMimeTypes;if(e.length<1)return Promise.resolve();var r=e.find((function(e){return t.timestampOffset.hasOwnProperty(e)}));return r?t.setTimestampOffset(r,t.timestampOffset[r]):t.setTimestampOffset(e[0],0)},this.firePictureInPictureEvent=function(){if(t.video){var e=t.video.isPictureInPicture()?d.ViewMode.PictureInPicture:d.ViewMode.Inline;t.context.store.dispatch((0,f.setPlayerViewMode)(e))}},this.resetConsecutiveErrorCountCallback=function(e){e.time&&e.time>0&&(t.consecutiveErrorCount=0)},this.logger=e.logger,this.video=e.videoElement,this.settings=e.settings,this.readyPromise=Promise.resolve(),this.eventHandler=void 0,this.timestampOffset={},this.sourceBufferMimeCodecMap=new E.BufferMimeCodecMap(e.store,e.settings),this.savedCurrentTime=0,this.playerEventHandler=e.eventHandler,this.periodSwitchOngoing=!1,this.init(!0)}return e.prototype.getSourceStore=function(){var e;return null===(e=this.context.serviceManager)||void 0===e?void 0:e.get(u.ServiceName.SourceStoreService,this.context.sourceContext.sourceIdentifier)},e.prototype.createMSEWrapper=function(){return new b.MSEWrapper(this.context)},e.prototype.createMse=function(e){return e?this.createMseSynchronously():this.createMseAsynchronously()},e.prototype.createMseAsynchronously=function(){var e=this;return function(){var t;return null===(t=e.mse)||void 0===t?void 0:t.createNewMSE()}},e.prototype.createMseSynchronously=function(){var e,t=null===(e=this.mse)||void 0===e?void 0:e.createNewMSE();return function(){return t}},e.prototype.init=function(e){var t=this;this.segmentQueueProcessingPromise=Promise.resolve(),this.mse=this.createMSEWrapper(),this.readyPromise=this.readyPromise.catch((function(e){return t.context.logger.debug("Caught error during MSE recreation",e)})).then(this.createMse(e)).then((function(){t.isShutdownForPeriodSwitch=!1})),this.needsInitialSeek=!0,this.segmentQueues={},this.setCurrentTimeContext=void 0,this.setCurrentTimeDelayedContext=void 0,this.quotaExceededMap=new Map,this.quotaExceededDeferredMap=new Map,this.gapHandler=new T.GapHandler(this.context),null==this.eventHandler&&this.video&&(this.eventHandler=new P.VideoEventHandler(this.video),this.eventHandler.on(v.MediaElementEvent.timeupdate,this.resetConsecutiveErrorCountCallback)),this.on(v.MediaElementEvent.webkitpresentationmodechanged,this.firePictureInPictureEvent),this.playerEventHandler.on(a.PlayerEvent.PeriodSwitch,this.onPeriodSwitch),this.playerEventHandler.on(a.PlayerEvent.Seek,this.onSeek),this.playerEventHandler.on(a.PlayerEvent.PeriodSwitched,this.onPeriodSwitched)},e.prototype.trackRendererError=function(e){this.consecutiveErrorCount++,this.consecutiveErrorCount>=this.settings.MAX_CONSECUTIVE_RENDERER_ERRORS&&this.context.eventHandler.fireError(new s.PlayerError(o.ErrorCode.PLAYBACK_VIDEO_DECODING_ERROR,{codec:e.getCodec(),mimeType:e.getMimeType(),segmentUrl:e.getUrl()},"Failed to append the segment to the buffer. The MSE has thrown an error."))},e.prototype.hasSourceBuffers=function(){return this.segmentQueueMimeTypes.length>0},e.prototype.hasDataInSourceBuffers=function(){var e=this.mse;return!(!e||!this.hasSourceBuffers())&&this.segmentQueueMimeTypes.every((function(t){return e.getBufferedRanges(t).length>0}))},e.prototype.addBuffer=function(e,t){var r,n=this;if(!this.mse)return!1;this.sourceBufferMimeCodecMap.add(e,t);var i=Boolean(this.mse.addBuffer(e,t));return i&&(this.mse.addUpdateEndCallback(e,(function(){return n.quotaExceededMap.set(e,!1)})),this.addUpdateEndListenerToUpdateRendererRanges(e),this.segmentQueues[e]=[],null===(r=this.getSourceStore())||void 0===r||r.dispatch((0,y.setRendererRanges)(e,[]))),i},e.prototype.addDrmInitData=function(e){if(null==e?void 0:e.length){var t=this.drmService;t?e.forEach((function(e){return t.addInitData(e)})):this.context.logger.debug("PSSH data found but DRM is not configured")}},e.prototype.storeDrmInitDataFromManifest=function(e){var t=this;e&&this.context.serviceManager.maybeCall(u.ServiceName.ManifestService,(function(r){var n=r.getContentProtectionForAdaptationSet(e).flatMap((function(e){var r=c.KeySystemKind[e.name.toUpperCase()],n=e.schemeIdUri.replace("urn:uuid:","").replace(/-/g,"");return(e.pssh||[]).map((function(i,o){return t.logger.insane("adding pssh for ".concat(e.name," : ").concat(i)),{initData:e.psshData[o],initDataStr:i,systemID:e.schemeIdUri,systemIDraw:n,systemName:r,kid:[]}}))}));t.addDrmInitData(n)}),void 0,this.context.sourceContext.sourceIdentifier)},e.prototype.appendData=function(e){var t=this;return this.addDrmInitData(e.getDrmInitData()),this.addSegmentToSegmentQueue(e),this.segmentQueueProcessingPromise=this.segmentQueueProcessingPromise.catch((function(){})).then((function(){return t.processSegmentQueues()})),this.segmentQueueProcessingPromise},e.prototype.addSegmentToSegmentQueue=function(e){var t,r=e.getMimeType();this.segmentQueues[r]?(this.segmentQueues[r].push(e),null===(t=this.getSourceStore())||void 0===t||t.dispatch((0,y.setRendererRanges)(r,this.getOverallBufferedRanges(r)))):this.logger.debug("Renderer missing segment queue for mimeType(".concat(r,") but trying to push segment.(url=").concat(e.getUrl(),")"))},e.prototype.getMSEBufferedRanges=function(e){var t,r;return null!==(r=null===(t=this.mse)||void 0===t?void 0:t.getBufferedRanges(e))&&void 0!==r?r:[]},e.prototype.getOverallBufferedRanges=function(e){if(!this.mse||!this.segmentQueues.hasOwnProperty(e))return[];var t=n.BufferRangeHelper.getRangesFromQueue(this.segmentQueues[e],this.settings.GAP_TOLERANCE);return t=t.concat(this.getMSEBufferedRanges(e)),t=n.BufferRangeHelper.mergeRanges(t,this.settings.GAP_TOLERANCE)},e.prototype.isDataBeingAppended=function(e){return!!this.mse&&(this.segmentQueues&&this.segmentQueues[e]&&this.segmentQueues[e].length>0||this.mse.isAnyBufferUpdating())},e.prototype.getRangesFromStore=function(e){var t,r=null===(t=this.getSourceStore())||void 0===t?void 0:t.getState();if(!r)return[];var n=(0,S.getBufferState)(r);return n?(0,S.getRendererBufferedRanges)(n,e):[]},e.prototype.getEndOfBufferTime=function(){var e=this,t=[];if(this.segmentQueueMimeTypes.forEach((function(r){var n=e.getRangesFromStore(r);if(n.length>0){var i=n[n.length-1].end;t.push(i)}})),0!==t.length)return Math.min.apply(Math,t)},e.prototype.removeDataFromSegmentQueues=function(e,t,r){var n,i=this;void 0===t&&(t=-1/0),void 0===r&&(r=1/0),this.segmentQueues.hasOwnProperty(e)&&(this.segmentQueues[e]=this.segmentQueues[e].filter((function(e){var n=e.getDuration(),o=e.getPlaybackTime(),s=e.getRepresentationId().representationId,u=e.isInit()||o<t||o+n>r;return i.logger.debug("[MSERenderer][".concat(s,"] Removing segment from queue [").concat(!u,"]. ")+"Clearing from ".concat(t," to ").concat(r,". Segment: [playbackTime=").concat(e.getPlaybackTime(),", ")+"duration=".concat(e.getDuration(),", url=").concat(e.getUrl(),"]")),u})),null===(n=this.getSourceStore())||void 0===n||n.dispatch((0,y.setRendererRanges)(e,this.getOverallBufferedRanges(e))))},e.prototype.removeData=function(e,t,r){return this.mse?(void 0===t&&void 0===r&&this.saveCurrentTime(),this.removeDataFromSegmentQueues(e,t,r),this.mse.removeFromBuffer(e,t,r)):Promise.reject()},e.prototype.getDroppedVideoFrames=function(){var e,t;return null!==(t=null===(e=this.video)||void 0===e?void 0:e.droppedVideoFrames)&&void 0!==t?t:0},e.prototype.setPlaybackSpeed=function(e){this.video&&!isNaN(e)&&e>0&&e!==this.video.playbackRate&&(this.video.playbackRate=e)},e.prototype.getPlaybackSpeed=function(){var e,t;return null!==(t=null===(e=this.video)||void 0===e?void 0:e.playbackRate)&&void 0!==t?t:1},e.prototype.setVolume=function(e){this.video&&!isNaN(e)&&(this.video.volume=Math.min(e/100,1))},e.prototype.getVolume=function(){var e,t;return 100*(null!==(t=null===(e=this.video)||void 0===e?void 0:e.volume)&&void 0!==t?t:1)},e.prototype.mute=function(){this.video&&(this.video.muted=!0)},e.prototype.unmute=function(){this.video&&(this.video.muted=!1)},e.prototype.isMuted=function(){var e,t;return null!==(t=null===(e=this.video)||void 0===e?void 0:e.muted)&&void 0!==t&&t},e.prototype.play=function(){var e=this;return this.video?this.video.play().catch((function(t){if(e.isShutdownForPeriodSwitch)return e.ready();throw t})):Promise.resolve()},e.prototype.pause=function(){this.video&&this.video.pause()},e.prototype.end=function(){this.pause(),this.cancelSetCurrentTimeDelayed()},e.prototype.isPaused=function(){var e,t;return null===(t=null===(e=this.video)||void 0===e?void 0:e.paused)||void 0===t||t},e.prototype.setDuration=function(e){this.mse&&(e=Math.floor(1e4*e)/1e4,this.duration=e,this.mse.setDuration(e))},e.prototype.getDuration=function(){var e,t;return null!==(t=null===(e=this.video)||void 0===e?void 0:e.duration)&&void 0!==t?t:NaN},e.prototype.setCurrentTime=function(e){var t=this;if(!this.mse)return Promise.reject("MSE is not open");if(e=Math.ceil(100*e)/100,this.setCurrentTimeContext){if(this.setCurrentTimeContext.time===e)return this.setCurrentTimeContext.promise;this.cancelSetCurrentTimeDelayed()}var r=Promise.resolve();this.isMSEOpen()||this.isTimeInBuffer(e)||(this.logger.debug("reopen MSE on setCurrentTime"),r=this.reOpenMse());var n=r.then((function(){return t.setCurrentTimeInternal(e).catch((function(r){return t.logger.debug("could not set time ".concat(e," on video element"),r),t.getCurrentTime()})).finally((function(){return t.needsInitialSeek=!1}))}));return this.setCurrentTimeContext={time:e,isInitialSeek:this.needsInitialSeek,promise:n},n},e.prototype.getCurrentVideoTime=function(){var e,t;return null!==(t=null===(e=this.video)||void 0===e?void 0:e.currentTime)&&void 0!==t?t:0},e.prototype.getCurrentFallbackTime=function(){var e=this.setCurrentTimeContext;return e&&e.isInitialSeek&&-1!==e.time?e.time:this.isVideoCurrentTimeUnreliable()?this.savedCurrentTime:(this.savedCurrentTime=0,this.getCurrentVideoTime())},e.prototype.isVideoCurrentTimeUnreliable=function(){var e;return!this.hasDataInSourceBuffers()&&!(null===(e=this.mse)||void 0===e?void 0:e.isBufferRemovalPending())||!(!this.savedCurrentTime||!this.periodSwitchOngoing&&this.isTimeInBuffer(this.getCurrentVideoTime()))},e.prototype.getCurrentTime=function(e){return e?this.getCurrentVideoTime():this.getCurrentFallbackTime()},e.prototype.getSnapshotData=function(e,t){void 0===t&&(t=1);try{if(!this.video)return;var r=this.video.videoWidth,n=this.video.videoHeight;this.snapshotCanvas||(this.snapshotCanvas=document.createElement("canvas"),this.snapshotCanvas.id="snapshotHiddenCanvas"),this.snapshotCanvas.width=r,this.snapshotCanvas.height=n;var i=this.snapshotCanvas.getContext("2d");null==i||i.drawImage(this.video.getWrappedElement(),0,0,r,n);var o=void 0;return"image/jpeg"===e||"image/webp"===e?(t=Math.max(t,0),t=Math.min(t,1),o=this.snapshotCanvas.toDataURL(e,t)):o=this.snapshotCanvas.toDataURL(e,t),{height:n,width:r,data:o}}catch(e){return void(e&&e.message?this.logger.debug("Snapshot acquisition failed: "+e.message):this.logger.debug("Snapshot acquisition failed"))}},e.prototype.getDrmShutdownPromise=function(){return this.drmService?this.drmService.shutdownPromise:Promise.resolve()},e.prototype.ready=function(){var e=this;return this.getDrmShutdownPromise().then((function(){var t;return null===(t=e.video)||void 0===t||t.eventHandler.clearEventSuppression(v.MediaElementEvent.error),e.mse||e.init(!1),e.readyPromise}))},e.prototype.setTimestampOffset=function(e,t){var r=this;return this.mse?this.mse.setTimestampOffset(e,t).then((function(){r.timestampOffset[e]=t})):Promise.resolve()},e.prototype.shutdown=function(e){var t,r=this;if(void 0===e&&(e=!1),!this.mse)return this.readyPromise;for(var n in this.isShutdownForPeriodSwitch=e,this.waitingForSeekedPromise=null,this.saveCurrentTime(),this.segmentQueues)this.segmentQueues.hasOwnProperty(n)&&(delete this.segmentQueues[n],null===(t=this.getSourceStore())||void 0===t||t.dispatch((0,y.setRendererRanges)(n,[])));var i=this.mse.tearDownMediaSource().catch((function(e){r.logger.debug("Could not tear down media source",{err:e,message:e.message})}));return this.mse=void 0,this.cancelSetCurrentTimeDelayed(),this.gapHandler&&(this.gapHandler.shutdown(),this.gapHandler=void 0),this.eventHandler&&!e&&(this.eventHandler.dispose(),this.eventHandler=void 0),this.quotaExceededMap.clear(),this.quotaExceededDeferredMap.clear(),e?this.readyPromise:this.readyPromise.then((function(){return i}))},e.prototype.release=function(){var e;for(var t in this.segmentQueues)this.segmentQueues.hasOwnProperty(t)&&null!==this.mse&&(delete this.segmentQueues[t],null===(e=this.getSourceStore())||void 0===e||e.dispatch((0,y.setRendererRanges)(t,[])));return this.sourceBufferMimeCodecMap.dispose(),this.mse&&this.mse.dispose(),this.readyPromise=Promise.resolve(),this.timestampOffset={},this.cancelSetCurrentTimeDelayed(),this.gapHandler&&(this.gapHandler.shutdown(),this.gapHandler=void 0),this.off(v.MediaElementEvent.webkitpresentationmodechanged,this.firePictureInPictureEvent),this.eventHandler&&(this.eventHandler.off(v.MediaElementEvent.timeupdate,this.resetConsecutiveErrorCountCallback),this.eventHandler.dispose(),this.eventHandler=void 0),this.waitingForSeekedPromise=null,this.playerEventHandler.off(a.PlayerEvent.PeriodSwitch,this.onPeriodSwitch),this.playerEventHandler.off(a.PlayerEvent.PeriodSwitched,this.onPeriodSwitched),this.playerEventHandler.off(a.PlayerEvent.Seek,this.onSeek),this.getDrmShutdownPromise()},e.prototype.on=function(e,t){var r;null===(r=this.eventHandler)||void 0===r||r.on(e,t)},e.prototype.off=function(e,t){this.eventHandler&&this.eventHandler.off(e,t)},Object.defineProperty(e.prototype,"drmService",{get:function(){var e;return null===(e=this.context.serviceManager)||void 0===e?void 0:e.get(u.ServiceName.DrmService)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"segmentQueueMimeTypes",{get:function(){return Object.keys(this.segmentQueues)},enumerable:!1,configurable:!0}),e.prototype.setDrmConfig=function(e,t){return this.drmService?this.drmService.updateDrmConfig(e,t):Promise.reject("DRM is not configured")},e.prototype.isMediaTypeSupported=function(e,t){return"MediaSource"in window&&MediaSource.isTypeSupported(e+'; codecs="'+t+'"')},e.prototype.cancelPendingEndOfStream=function(){this.setEndOfStreamDeferred&&(this.setEndOfStreamDeferred.reject(new Error("Cancelled pending end of stream.")),this.setEndOfStreamDeferred=void 0)},e.prototype.deferSetEndOfStream=function(){var e=this;return this.setEndOfStreamDeferred=this.setEndOfStreamDeferred||new l.Deferred,this.setEndOfStreamDeferred.promise.then((function(){var t;return null===(t=e.mse)||void 0===t?void 0:t.endOfStream()})).catch((function(t){(0,p.isContextAvailable)(e.context)&&e.context.logger.debug(t)}))},e.prototype.setEndOfStream=function(e){if(void 0===e&&(e=!0),!e)return this.cancelPendingEndOfStream(),this.isMSEOpen()?Promise.resolve():this.reOpenMse();if(!this.hasSourceBuffers()||!this.mse)return this.logger.debug("Cannot signal EOS as no buffers have been added yet"),Promise.resolve();var t=this.getEndOfBufferTime();return this.setCurrentTimeDelayedContext&&this.setCurrentTimeDelayedContext.time>=this.duration&&t&&!isNaN(t)&&this.cancelSetCurrentTimeDelayed(this.setCurrentTimeInternal(t)),this.setCurrentTimeDelayedContext?this.deferSetEndOfStream():this.mse.endOfStream()},e.prototype.isTimeInRangePendingRemoval=function(e){var t=this.getRangesPendingRemoval();for(var r in t){var n=t[r];if(n.start<=e&&n.end>=e)return!0}return!1},e.prototype.isTimeInBuffer=function(e,t){if(void 0===t&&(t=0),this.isTimeInRangePendingRemoval(e))return!1;var r=this.getRangesInSourceBuffers();return!!r&&Object.keys(r).every((function(i){return(0,n.isInTimeRanges)(r[i],e,t)}))},e.prototype.adjustTimeToNextCommonBufferStart=function(e){var t=M(this.context.sourceContext.source);if(this.isTimeInBuffer(e,t))return e;var r=this.isTimeInBuffer(e),n=this.getFutureBufferStarts(e).filter((function(t){return t>=e})),i=0===n.length;if(r&&i){var o=e-t;return this.isTimeInBuffer(o)?(this.logger.debug("Adjusting current time away from end of buffer: ".concat(o)),o):e}return!r&&i?NaN:(e=Math.min.apply(null,n),this.logger.debug("Adjusting current time to next buffer start: ".concat(e)),e)},e.prototype.getFutureBufferStarts=function(e){var t,r=this.getRangesInSourceBuffers();if(!r)return[];if(this.mse){var i=this.getRangesPendingRemoval();t=Object.keys(i).map((function(e){return i[e]}))}else t=[];return n.BufferRangeHelper.getCommonBufferedRanges(r).filter((function(t){return t.getEnd()>=e&&!isNaN(t.getStart())})).filter((function(e){return t.every((function(t){return(0,n.areDisjoint)(t,{start:e.getStart(),end:e.getEnd()})}))})).map((function(e){return e.getStart()}))},e.prototype.getRangesInSourceBuffers=function(){if(!this.mse)return null;var e={};for(var t in this.segmentQueues)if(this.segmentQueues.hasOwnProperty(t)&&(e[t]=this.mse.getBufferedRanges(t),e[t].length<1))return null;return Object.keys(e).length?e:null},e.prototype.getRangesPendingRemoval=function(){if(!this.mse||!this.mse.isBufferRemovalPending())return{};var e={};for(var t in this.segmentQueues){var r=this.mse.getRangePendingRemoval(t);this.segmentQueues.hasOwnProperty(t)&&r&&(e[t]=r)}return e},e.prototype.processSegmentQueues=function(){var e=this,t=this.segmentQueueMimeTypes.filter((function(t){return e.segmentQueues[t].length>0})).map((function(t){return e.addSegmentFromQueueToMse(t)}));return 0===t.length?Promise.resolve():Promise.all(t).then((function(){return e.processSegmentQueues()})).catch((function(e){if(e!==i.SOURCE_BUFFER_APPEND_STATUS.SUSPENDED)throw e}))},e.prototype.getHeadOfQueue=function(e){return this.segmentQueues[e][0]},e.prototype.isMSEOpen=function(){var e;return(null===(e=this.mse)||void 0===e?void 0:e.readyState)===b.MediaSourceReadyState.open},e.prototype.maybeWaitForDrmLicense=function(e){var t,r,n=null===(r=null===(t=this.getSourceStore())||void 0===t?void 0:t.getState())||void 0===r?void 0:r.drm;return this.context.serviceManager.maybeCall(u.ServiceName.DrmService,(function(t){return t.maybeWaitForDrmLicense(e,n)}),Promise.resolve())},e.prototype.addSegmentFromQueueToMse=function(e){var t=this;if(!this.mse)return Promise.resolve();var r=Promise.resolve();this.isMSEOpen()||(r=this.reOpenMse());var n=this.getHeadOfQueue(e);if(!n)return Promise.resolve();var o=n.getRepresentationId().representationId,s=n.getUrl();return this.context.logger.debug("[MSERenderer][".concat(o,"] Scheduling appendage to buffer [url=").concat(s,"],")+" drm key ID(".concat(n.getDrmKid(),")")),r.then((function(){return t.maybeWaitForDrmLicense(n)})).then((function(){return t.mse?t.segmentQueues[e].includes(n)?t.mse.addToBuffer(n).then((function(){var r=t.getHeadOfQueue(e)!==n;if(t.logger.debug("[MSERenderer][".concat(o,"] Appended segment to buffer [url=").concat(s,"]")),r){var i=t.segmentQueues[e][0],u=i?i.getUrl():"none";t.logger.debug("[MSERenderer][".concat(o,"] Skipping removal of [url=").concat(s,"] ")+"from segment queue as the queue head has unexpectedly changed to [url=".concat(u,"]"))}else t.segmentQueues[e].shift();t.drmService&&t.hasDataInSourceBuffers()&&!t.periodSwitchOngoing&&t.drmService.signalInitDataShouldBeAvailable()})):(t.logger.debug("[MSERenderer] Segment ".concat(n.getUrl()," no longer part of the queue - skipping appendage")),Promise.resolve()):Promise.reject(i.SOURCE_BUFFER_APPEND_STATUS.FAILURE)})).catch((function(r){if(r===i.SOURCE_BUFFER_APPEND_STATUS.FAILURE&&t.trackRendererError(n),t.mse&&r===i.SOURCE_BUFFER_APPEND_STATUS.QUOTA_EXCEEDED){t.quotaExceededMap.set(e,!0);var o=t.quotaExceededDeferredMap.get(e);return o||(o=new l.Deferred,t.quotaExceededDeferredMap.set(e,o)),t.mse.addOneUpdateEndCallback(e,o.resolve).then((function(){t.quotaExceededDeferredMap.delete(e),t.context.logger.debug("Appending segment after quota has been exceeded...")})),o.promise.then((function(){return t.processSegmentQueues()}))}return t.mse?t.mse.queueActionOnBuffer(e,(function(){return t.processSegmentQueues()})):Promise.reject(r)}))},e.prototype.cancelSetCurrentTimeDelayed=function(e){void 0===e&&(e=this.getCurrentTime()),this.setCurrentTimeDelayedContext&&(clearTimeout(this.setCurrentTimeDelayedContext.timeoutId),this.setCurrentTimeDelayedContext.promiseResolve(e),this.setCurrentTimeDelayedContext=void 0)},e.prototype.recoverFromExceededQuota=function(e){var t=this;this.segmentQueueMimeTypes.forEach((function(r){var n;t.segmentQueues[r]=t.segmentQueues[r].filter((function(t){return t.getPlaybackTime()+t.getDuration()>=e})),null===(n=t.getSourceStore())||void 0===n||n.dispatch((0,y.setRendererRanges)(r,t.getOverallBufferedRanges(r))),t.quotaExceededMap.set(r,!1)})),this.quotaExceededDeferredMap.forEach((function(e){return e.reject()})),this.quotaExceededDeferredMap.clear()},e.prototype.setCurrentTimeDelayed=function(e){var t,r,n=this;this.logger.debug("delayed set time ".concat(e," on video element"));var i=null!==(r=null===(t=this.setCurrentTimeDelayedContext)||void 0===t?void 0:t.promiseResolve)&&void 0!==r?r:Promise.resolve;return this.setCurrentTimeDelayedContext&&clearTimeout(this.setCurrentTimeDelayedContext.timeoutId),this.setCurrentTimeDelayedContext=void 0,new Promise((function(t,r){n.setCurrentTimeDelayedContext={time:e,promiseReject:r,promiseResolve:t,timeoutId:setTimeout((function(){t(n.setCurrentTimeInternal(e).then((function(e){return i.call(Promise,e),e})))}),(0,g.toMilliSeconds)(n.settings.SYNC_ON_SEEK_TIMEOUT))}}))},e.prototype.resolvePendingEndOfStream=function(){this.setEndOfStreamDeferred&&(this.setEndOfStreamDeferred.resolve(),this.setEndOfStreamDeferred=void 0)},e.prototype.setCurrentTimeInternal=function(e){var t=this;if(!this.mse)return Promise.reject("Couldn't set current time, MSE is not open");R(this.quotaExceededMap,(function(e){return e}))&&this.recoverFromExceededQuota(e);var r=this.mse.waitForBuffers().then((function(){return t.waitingForSeekedPromise})).then((function(){if(t.setCurrentTimeContext){if(t.setCurrentTimeContext.time!==e)return Promise.reject("A newer setting of change time has been scheduled.")}else t.setCurrentTimeContext={time:e,isInitialSeek:!1,promise:r};var n=t.adjustTimeToNextCommonBufferStart(e);return isNaN(n)?t.setCurrentTimeDelayed(e):(t.logger.debug("set time on video element to ".concat(n)),t.seekOnVideoElement(n).then((function(e){return t.cancelSetCurrentTimeDelayed(),t.resolvePendingEndOfStream(),e})).catch((function(e){return t.handleVideoSetCurrentTimeError(n,e)})).finally((function(){t.waitingForSeekedPromise=null,t.setCurrentTimeContext=void 0,t.savedCurrentTime=0})))}));return r},e.prototype.handleVideoSetCurrentTimeError=function(e,t){return this.logger.debug("failed to set current time",t),this.waitingForSeekedPromise=null,this.setCurrentTimeDelayed(e)},e.prototype.seekOnVideoElement=function(e){var t=this;return this.waitingForSeekedPromise=new Promise((function(r,n){t.video?(t.video.currentTime=e,r(t.video.currentTime)):n("No video reference")})),this.waitingForSeekedPromise},e.prototype.saveCurrentTime=function(){this.setCurrentTimeContext?this.savedCurrentTime=this.setCurrentTimeContext.time:this.savedCurrentTime=this.getCurrentVideoTime()},e.prototype.recreateSourceBuffers=function(e){var t=this;return void 0===e&&(e=this.getCurrentTime()),this.shutdown().then((function(){return t.ready()})).then((function(){t.sourceBufferMimeCodecMap.forEach((function(e,r){t.addBuffer(e,r)||(t.context.logger.debug("Failed to create source buffer ".concat(e)),t.sourceBufferMimeCodecMap.remove(e))}))})).then((function(){t.setCurrentTime(e).then((function(){var e,r;return(null===(r=null===(e=t.context.serviceManager)||void 0===e?void 0:e.get(u.ServiceName.PlayerStateService))||void 0===r?void 0:r.isPlaying())?t.play():Promise.resolve()}))}))},e.prototype.updateSegmentQueueMimeType=function(e){var t,r=this,n=m.MimeTypeHelper.getMediaType(e);this.segmentQueueMimeTypes.forEach((function(e){var t;m.MimeTypeHelper.getMediaType(e)===n&&(delete r.segmentQueues[e],null===(t=r.getSourceStore())||void 0===t||t.dispatch((0,y.setRendererRanges)(e,[])))})),this.segmentQueues[e]=[],null===(t=this.getSourceStore())||void 0===t||t.dispatch((0,y.setRendererRanges)(e,[]))},e.prototype.addUpdateEndListenerToUpdateRendererRanges=function(e){var t,r=this;null===(t=this.mse)||void 0===t||t.addUpdateEndCallback(e,(function(){var t;return null===(t=r.getSourceStore())||void 0===t?void 0:t.dispatch((0,y.setRendererRanges)(e,r.getOverallBufferedRanges(e)))}))},e.prototype.changeBufferType=function(e,t){var r=this;return this.sourceBufferMimeCodecMap.update(e,t),this.updateSegmentQueueMimeType(e),this.mse&&this.mse.isChangeTypeSupported()?this.mse.changeBufferType(e,t).then((function(){return r.addUpdateEndListenerToUpdateRendererRanges(e)})).then((function(){var r;return(r={})[e]=t,r})):this.recreateSourceBuffers().then((function(){return r.sourceBufferMimeCodecMap.entries()}))},e}();function R(e,t){var r=!1;return e.forEach((function(e){return r=r||t(e)})),r}function M(e){var t,r=(0,h.getCapabilities)(),n=r.isChromium,i=r.isChrome;return n&&!i&&(null===(t=e.drm)||void 0===t?void 0:t.playready)?1.25:.25}t.MSERenderer=C},50022:function(e,t,r){var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},n.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.MSEWrapper=t.MediaSourceReadyState=void 0;var i,o=r(14809),s=r(36166),u=r(85739),a=r(99538),d=r(55579),c=r(59574),f=r(1520),h=r(15949),p=r(74294),l=r(81028),m=r(50163),g=r(89199),v=r(20586),y=r(11165);!function(e){e.closed="closed",e.open="open",e.ended="ended"}(i=t.MediaSourceReadyState||(t.MediaSourceReadyState={}));var S=function(){function e(e){var t=this;this.teardownInProgressPromise=Promise.resolve(),this.waitForBuffer=function(e){return t.sourceBuffers.hasOwnProperty(e)?t.mseReady().then((function(){return t.sourceBuffers[e].ready()})):Promise.reject("No SourceBuffer for '".concat(e,"' available"))},e.videoElement&&(this.context=e,this.logger=e.logger,this.video=e.videoElement,this.sourceBuffers={},this.isInit=!1,this.updateEndListeners=new p.ArrayMap)}return e.prototype.getBufferedRanges=function(e){return this.sourceBuffers.hasOwnProperty(e)?this.sourceBuffers[e].bufferedRanges:[]},e.prototype.printDetailedBufferRange=function(e,t){var r;try{r=e.buffered}catch(e){return}for(var n=0;n<r.length;n++)this.logger.debug(t+" buffer range ["+n+"]: "+r.start(n)+" - "+r.end(n))},e.prototype.getBufferStartTime=function(){var e=this,t=Object.keys(this.sourceBuffers).map((function(t){return 0===e.sourceBuffers[t].bufferedRanges.length?0:e.sourceBuffers[t].bufferedRanges[0].start}));return Math.max.apply(null,t)},e.prototype.onBufferChanged=function(e,t){if(t&&"target"in t&&t.target){var r=t.target;this.printDetailedBufferRange(r,e)}},e.prototype.addBuffer=function(e,t){if(this.mediaSource){if(this.isInit&&!this.sourceBuffers.hasOwnProperty(e))try{var r=this.mediaSource.addSourceBuffer(e+"; codecs="+t);this.sourceBuffers[e]=new y.SourceBufferWrapper(r),this.addBufferChangedUpdateEndCallback(e)}catch(r){return this.logger.debug("Could not add SourceBuffer for "+e+" with codecs "+t+":"+r),void this.context.eventHandler.dispatchEvent(c.PlayerEvent.Warning,new a.PlayerWarning(d.WarningCode.SOURCE_CODEC_OR_FILE_FORMAT_NOT_SUPPORTED))}return this.logger.debug("Added SourceBuffer for "+e+" with codecs "+t),isNaN(this.mediaSource.duration)||(this.sourceBuffers[e].appendWindowEnd=this.mediaSource.duration),this.sourceBuffers[e].buffer}},e.prototype.updateTimestampOffset=function(e,t){var r=this.sourceBuffers[e];r&&(this.logger.debug("setting new source buffer [".concat(e,"] offset from ").concat(r.buffer.timestampOffset," to ").concat(t)),r.buffer.timestampOffset=t)},e.prototype.setTimestampOffset=function(e,t){return this.sourceBuffers.hasOwnProperty(e)?(t&&!isNaN(t)||(this.logger.debug("source buffer [".concat(e,"] offset is ").concat(t,", setting it to 0")),t=0),this.queueTimestampOffsetUpdate(e,t)):(this.logger.debug("no such source buffer found (mime type=".concat(e,")")),Promise.resolve())},e.prototype.queueTimestampOffsetUpdate=function(e,t){var r=this;return this.queueActionOnBuffer(e,(function(){return r.updateTimestampOffset(e,t)})).catch((function(t){r.logger.debug("Failed to set timestamp offset for",e,":",t)}))},e.prototype.getBufferRangeStart=function(e,t){return t||e.buffered.start(0)},e.prototype.getBufferRangeEnd=function(e,t){return t||e.buffered.end(e.buffered.length-1)},e.prototype.getBufferRemovalRange=function(e,t,r){var n=this.sourceBuffers[e].buffer;return{start:this.getBufferRangeStart(n,t),end:this.getBufferRangeEnd(n,r)}},e.prototype.postBufferRemoval=function(e,t,r){this.logger.debug("successfully removed buffer for ".concat(e," (from  ").concat(t," to ").concat(r,")"))},e.prototype.preBufferRemoval=function(e,t,r){this.logger.debug("removing buffer for ".concat(e," (from ").concat(t," to ").concat(r,")"))},e.prototype.removeBufferRange=function(e,t,r){this.preBufferRemoval(e,t,r),this.sourceBuffers[e].buffer.remove(t,r)},e.prototype.removeFromBuffer=function(e,t,r){var n=this;return this.queueActionOnBuffer(e,(function(){var o,s,u;try{if(n.video&&n.video.currentTime>=0&&(null===(u=null===(s=null===(o=n.sourceBuffers[e])||void 0===o?void 0:o.buffer)||void 0===s?void 0:s.buffered)||void 0===u?void 0:u.length)>0){var f=n.getBufferRemovalRange(e,t,r),h=f.start,p=f.end;if(h>=0&&p>h){if(n.sourceBuffers[e].removalPending=!0,n.sourceBuffers[e].rangePendingRemoval={start:h,end:p},!n.mediaSource||n.mediaSource.readyState===i.open){var l=n.sourceBuffers[e].onUpdateEnded().then((function(){n.sourceBuffers[e]&&(n.sourceBuffers[e].rangePendingRemoval=null,n.sourceBuffers[e].removalPending=!1,n.postBufferRemoval(e,h,p))}));return n.removeBufferRange(e,h,p),l}n.logger.debug("cannot remove buffer for "+e+" (from "+h+" to "+p+"): MediaSource is not open"),n.addOneSourceOpenCallback((function(){n.removeFromBuffer(e,h,p).catch((function(t){n.logger.debug("Couldn't remove buffer from ".concat(h," to ").concat(p," for ").concat(e),t)}))}))}}}catch(e){var m="".concat(d.WarningCode[d.WarningCode.PLAYBACK_WARNING],". Exception: ").concat(JSON.stringify(e));n.context.eventHandler.dispatchEvent(c.PlayerEvent.Warning,new a.PlayerWarning(d.WarningCode.PLAYBACK_WARNING,m))}return Promise.resolve()}))},e.prototype.removeBuffer=function(e){var t=this,r=Promise.resolve(),i=this.sourceBuffers[e];if(!i||!this.mediaSource)return r;if(this.isMediaSourceOpen())try{null==i||i.buffer.abort()}catch(e){return this.logger.debug("Could not abort last action on buffer",n({},e)),Promise.resolve()}if(m.MimeTypeHelper.isSubtitle(e))r=r.then((function(){return t.removeFromBuffer(e).catch((function(e){t.logger.debug("Error removing buffer data",e)}))}));else try{(this.updateEndListeners.get(e)||[]).slice().forEach((function(r){t.removeUpdateEndCallback(e,r)})),this.mediaSource&&this.mediaSource.removeSourceBuffer(i.buffer)}catch(e){this.logger.debug("Error while trying to remove source buffer.",e)}return this.deleteSourceBuffer(e),r},e.prototype.deleteSourceBuffer=function(e){this.sourceBuffers[e]?(this.sourceBuffers[e].dispose(),delete this.sourceBuffers[e],this.logger.debug("Removed SourceBuffer for ".concat(e))):this.logger.debug("No source buffer to remove for mimeType=".concat(e))},e.prototype.isMediaSourceOpen=function(){var e;return(null===(e=this.mediaSource)||void 0===e?void 0:e.readyState)===i.open},e.prototype.resetAllBuffers=function(){var e=this;if(!this.mediaSource)return this.logger.debug("Media source is removed. Can not reset buffers."),Promise.resolve();var t=[];for(var r in this.sourceBuffers)this.sourceBuffers.hasOwnProperty(r)&&t.push(this.removeBuffer(r));return Promise.all(t).then((function(){e.sourceBuffers={},e.logger.debug("Removed all SourceBuffers")}))},e.prototype.tearDownMediaSource=function(){var e=this;return this.mediaSource?(this.logger.debug("Tearing down media source."),this.teardownInProgressPromise=this.teardownInProgressPromise.then((function(){return e.resetAllBuffers().then((function(){e.detachVideoElementAndMSE()}))})),this.teardownInProgressPromise):(this.logger.debug("Media source has already been removed."),this.teardownInProgressPromise.then((function(){return e.resetAllBuffers()})))},e.prototype.detachVideoElementAndMSE=function(){if(this.video)if(null!==this.video.getWrappedElement()){if(window&&window.URL&&"function"==typeof window.URL.revokeObjectURL&&""!==this.video.src)try{window.URL.revokeObjectURL(this.video.src)}catch(e){}this.mediaSourceReadyDeferred&&this.mediaSourceReadyDeferred.reject("MediaSource is being destroyed."),this.mediaSourceReadyDeferred=void 0,this.mediaSourceReadyPromise=void 0,v.VideoElementUtil.removeSource(this.video),this.video.load(),this.mediaSource=void 0,this.isInit=!1,this.updateEndListeners.clear(),this.logger.debug("Detached video element and MSE")}else this.logger.debug("No video element to teardown.");else this.logger.debug("No video wrapper to teardown.")},e.prototype.removeUpdateEndCallback=function(e,t){this.sourceBuffers.hasOwnProperty(e)&&this.sourceBuffers[e].buffer.removeEventListener("updateend",t)},e.prototype.addUpdateEndCallback=function(e,t){this.sourceBuffers.hasOwnProperty(e)&&this.sourceBuffers[e].buffer.addEventListener("updateend",t)},e.prototype.addOneUpdateEndCallback=function(e,t){return this.sourceBuffers[e].onUpdateEnded().catch((function(){})).then(t)},e.prototype.addSourceOpenCallback=function(e){this.mediaSource&&this.mediaSource.addEventListener("sourceopen",e)},e.prototype.removeSourceOpenCallback=function(e){this.mediaSource&&this.mediaSource.removeEventListener("sourceopen",e)},e.prototype.addOneSourceOpenCallback=function(e){var t=this,r=function(n){t.removeSourceOpenCallback(r),e(n)};this.addSourceOpenCallback(r)},e.prototype.isAnyBufferUpdating=function(){var e=this;return 0!==Object.keys(this.sourceBuffers).filter((function(t){return e.sourceBuffers[t].buffer.updating})).length},e.prototype.setDuration=function(e){var t=this;this.queueActionOnBuffers((function(){if(t.mediaSource){var r=(0,g.isNumber)(e)&&e>0?e:1/0;t.mediaSource.duration!==r&&(t.isMediaSourceOpen()?(t.logger.debug("Setting video duration on MSE: ".concat(t.mediaSource.duration," -> ").concat(r)),t.mediaSource.duration=r):t.logger.debug("Skipping setDuration (".concat(t.mediaSource.duration," -> ").concat(r,"), MSE is not open")))}else t.logger.debug("Skipping setDuration (".concat(e,"), MSE is gone"))})).catch((function(e){t.logger.debug("Could not set the duration of the MSE!",e)}))},e.prototype.getDuration=function(){return this.mediaSource&&!isNaN(this.mediaSource.duration)?this.mediaSource.duration:0},e.prototype.isInitialized=function(){return this.isInit},Object.defineProperty(e.prototype,"readyState",{get:function(){return this.mediaSource?this.mediaSource.readyState:void 0},enumerable:!1,configurable:!0}),e.prototype.isBufferRemovalPending=function(){var e=this;return Object.keys(this.sourceBuffers).some((function(t){return e.sourceBuffers[t].removalPending}))},e.prototype.getRangePendingRemoval=function(e){var t,r,n;return null!==(n=null===(r=null===(t=this.sourceBuffers)||void 0===t?void 0:t[e])||void 0===r?void 0:r.rangePendingRemoval)&&void 0!==n?n:void 0},e.prototype.getBufferSizeInSeconds=function(e){return this.getBufferedRanges(e).reduce((function(e,t){return e+(t.end-t.start)}),0)},e.prototype.addToBuffer=function(e){var t=this,r=e.getMimeType();return this.queueActionOnBuffer(r,(function(){if(!t.mediaSource)return t.logger.debug("Could not queue action on SourceBuffer: MediaSource has been destroyed"),Promise.reject(o.SOURCE_BUFFER_APPEND_STATUS.FAILURE);if(t.mediaSource.readyState!==i.open)return t.logger.warn("MediaSource is not open (readyState="+t.mediaSource.readyState+")"),Promise.reject(o.SOURCE_BUFFER_APPEND_STATUS.FAILURE);if(!t.sourceBuffers.hasOwnProperty(r))return t.logger.log("sourceBuffers has no entry for "+r),Promise.reject(o.SOURCE_BUFFER_APPEND_STATUS.FAILURE);var n=e.getRepresentationId().representationId;try{return t.logger.debug("[MSEWrapper][".concat(r,"][").concat(n,"] Adding segment to SourceBuffer [").concat(e.getUrl(),"]")),t.sourceBuffers[r].buffer.appendBuffer(e.getData()),Promise.resolve()}catch(i){return i.name&&"QuotaExceededError"===i.name?(t.logger.debug("QuotaExceededError, trying to remove old data from buffers..."),t.context.store.dispatch((0,f.setBufferMaxSize)(r,t.getBufferSizeInSeconds(r))),Promise.reject(o.SOURCE_BUFFER_APPEND_STATUS.QUOTA_EXCEEDED)):(t.video&&t.video.error||t.context.eventHandler.fireError(new u.PlayerError(s.ErrorCode.UNKNOWN,{exception:i,codec:e.getCodec(),mimeType:r,segmentUrl:e.getUrl()},"Unexpected error while attempting to append a segment to the SourceBuffer.")),t.logger.debug("[MSEWrapper][".concat(r,"][").concat(n,"] Failed appending segment to SourceBuffer"),i),Promise.reject(o.SOURCE_BUFFER_APPEND_STATUS.FAILURE))}}))},e.prototype.endOfStream=function(){var e=this;return this.queueActionOnBuffers((function(){var t;e.isMediaSourceOpen()?(e.logger.debug("Signaled mse end of stream"),null===(t=e.mediaSource)||void 0===t||t.endOfStream()):e.logger.debug("Skipped signaling EOS as the mse is not open")})).catch((function(t){e.logger.debug("Unable to signal EOS on media source",t)}))},e.prototype.waitForBuffers=function(){var e=Object.keys(this.sourceBuffers).map(this.waitForBuffer);return this.mseReady().then((function(){return Promise.all(e).then((function(){}))}))},e.prototype.queueActionOnBuffers=function(e){var t=this,r=new Promise((function(e,n){var i=Object.keys(t.sourceBuffers).map((function(e){var n=t.queueActionOnBuffer(e,(function(){}));return t.queueActionOnBuffer(e,(function(){return r})).then().catch(),n}));Promise.all(i).then((function(){return e()}),n)})).then((function(){return e()})).then((function(){return Promise.all(Object.keys(t.sourceBuffers).map((function(e){return t.sourceBuffers[e].ready()}))).then((function(){}))}));return r},e.prototype.queueActionOnBuffer=function(e,t){return this.sourceBuffers.hasOwnProperty(e)?this.sourceBuffers[e].queueAction(t):Promise.reject("No SourceBuffer for '".concat(e,"' available"))},e.prototype.rejectMediaSourceReady=function(e){var t,r=this;return null===(t=this.mediaSourceReadyDeferred)||void 0===t||t.reject(e),this.mediaSourceReadyPromise?this.mediaSourceReadyPromise.then((function(){r.mediaSourceReadyDeferred=void 0})):Promise.reject(e)},e.prototype.mseReady=function(){var e=this;if(this.mediaSourceReadyPromise)return this.mediaSourceReadyPromise;this.mediaSourceReadyDeferred=new l.Deferred,this.mediaSourceReadyPromise=this.mediaSourceReadyDeferred.promise;var t=function(t){var r;n(),null===(r=e.mediaSourceReadyDeferred)||void 0===r||r.reject(t)},r=function(){var t;n(),e.isInit=!0,null===(t=e.mediaSourceReadyDeferred)||void 0===t||t.resolve()},n=function(){e.mediaSource&&(e.mediaSource.removeEventListener("error",t),e.mediaSource.removeEventListener("sourceopen",r),e.mediaSource.removeEventListener("webkitsourceopen",r))};return this.video?this.mediaSource?(this.mediaSource.addEventListener("error",t),this.mediaSource.addEventListener("sourceopen",r,!1),this.mediaSource.addEventListener("webkitsourceopen",r,!1),window&&window.URL&&"function"==typeof window.URL.createObjectURL?this.video.src=window.URL.createObjectURL(this.mediaSource):(this.logger.debug("Could not use window.URL.createObjectURL(mediaSource) as the browser claims the function does not exist."),this.mediaSourceReadyDeferred.reject("Could not create Object URL")),this.mediaSourceReadyPromise.then((function(){e.mediaSourceReadyDeferred=void 0}))):this.rejectMediaSourceReady("mediaSource must not be null or undefined"):this.rejectMediaSourceReady("Could not set source to video element")},e.prototype.createNewMSE=function(){var e=this;return this.mediaSource?this.tearDownMediaSource().then((function(){return e.setNewMediaSource()})):this.setNewMediaSource()},e.prototype.setNewMediaSource=function(){return this.mediaSource=new window.MediaSource,this.mseReady()},e.prototype.isChangeTypeSupported=function(){var e,t;return!!(null===(t=null===(e=window.SourceBuffer)||void 0===e?void 0:e.prototype)||void 0===t?void 0:t.changeType)&&!(0,h.getCapabilities)().isTizen},e.prototype.addBufferChangedUpdateEndCallback=function(e){var t=this,r=function(r){return t.onBufferChanged(e,r)};this.addUpdateEndCallback(e,r),this.updateEndListeners.add(e,r)},e.prototype.updateSourceBufferKey=function(e){var t=this,r=m.MimeTypeHelper.getMediaType(e),n=Object.keys(this.sourceBuffers).find((function(n){var i=m.MimeTypeHelper.getMediaType(n);return t.sourceBuffers.hasOwnProperty(n)&&i===r&&n!==e}));n&&(this.removeAllUpdateEndCallbacks(n),this.sourceBuffers[e]=this.sourceBuffers[n],delete this.sourceBuffers[n],this.addBufferChangedUpdateEndCallback(e))},e.prototype.removeAllUpdateEndCallbacks=function(e){var t=this;this.updateEndListeners.get(e).forEach((function(r){t.removeUpdateEndCallback(e,r)})),this.updateEndListeners.delete(e)},e.prototype.changeBufferType=function(e,t){var r=this;return this.updateSourceBufferKey(e),this.queueActionOnBuffer(e,(function(){r.sourceBuffers[e].changeType("".concat(e,"; codecs=").concat(t)),r.context.logger.debug("Changed ".concat(e," SourceBuffer type with codec=").concat(t))}))},e.prototype.dispose=function(){var e=this;this.tearDownMediaSource().then((function(){e.video=void 0}))},e}();t.MSEWrapper=S},26463:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.MSERendererModuleDefinition=void 0;var n=r(83024),i=r(5526),o=r(50022),s=r(91689),u=r(73729);t.MSERendererModuleDefinition={name:n.ModuleName.RendererMse,module:{MSEWrapper:o.MSEWrapper,MSERenderer:i.MSERenderer,Ranges:s.Ranges,technologyChecker:new u.TechnologyChecker}},t.default=t.MSERendererModuleDefinition},86906:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.LinkedListQueue=void 0;var r=function(){function e(e){this.value=e}return e}(),n=function(){function e(){this.count=0}return Object.defineProperty(e.prototype,"length",{get:function(){return this.count},enumerable:!1,configurable:!0}),e.prototype.dequeue=function(){if(0!==this.count){var e=this.last;return this.last=null==e?void 0:e.previous,e&&(e.previous=void 0,e.next=void 0),this.count--,null==e?void 0:e.value}},e.prototype.enqueue=function(e){if(0===this.count){var t=new r(e);this.first=t,this.last=t}else{var n=this.first;this.first=new r(e),this.first.next=n,n&&(n.previous=this.first)}this.count++},e.prototype.isEmpty=function(){return 0===this.length},e}();t.LinkedListQueue=n},91689:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Ranges=void 0;var r=function(){function e(){}return e.filterRanges=function(t,r){var n=[];if(t&&t.length)for(var i=0;i<t.length;i++)r(t.start(i),t.end(i))&&n.push([t.start(i),t.end(i)]);return e.createTimeRanges(n)},e.createTimeRangesObj=function(e){return void 0===e||0===e.length?{length:0,start:function(){return 0},end:function(){return 0}}:{length:e.length,start:function(t){return e[t][0]},end:function(t){return e[t][1]}}},e.createTimeRanges=function(t,r){return Array.isArray(t)?e.createTimeRangesObj(t):void 0===t||void 0===r?e.createTimeRangesObj():e.createTimeRangesObj([[t,r]])},e.findNextRange=function(t,r){return e.filterRanges(t,(function(t,n){return t-e.TIME_FUDGE_FACTOR>=r&&n-t>e.MIN_RANGE_DURATION}))},e.findGaps=function(t){if(t.length<2)return e.createTimeRanges();for(var r=[],n=1;n<t.length;n++){var i=t.end(n-1),o=t.start(n);o-i>0&&r.push([i,o])}return e.createTimeRanges(r)},e.TIME_FUDGE_FACTOR=1/30,e.MIN_RANGE_DURATION=.2,e}();t.Ranges=r},11165:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.SourceBufferWrapper=void 0;var n=r(81028),i=r(86906),o=function(){function e(e){var t=this;this.onUpdateSuccess=function(){t.updateExposedBufferRanges(),t.cleanUpPendingUpdateEndedPromises((function(e){return e.resolve()}))},this.onUpdateError=function(e){t.cleanUpPendingUpdateEndedPromises((function(t){return t.reject(e)}))},this.ready=function(){return t.buffer.updating?t.onUpdateEnded():Promise.resolve()},this.buffer=e,this.bufferedRanges=[],this.queuePromise=Promise.resolve(),this.pendingUpdateEndedPromises=new i.LinkedListQueue,["error","abort","sourceended","sourceclose"].forEach((function(e){t.buffer.addEventListener(e,t.onUpdateError)})),this.buffer.addEventListener("updateend",this.onUpdateSuccess)}return e.prototype.cleanUpPendingUpdateEndedPromises=function(e){for(var t;null!=(t=this.pendingUpdateEndedPromises.dequeue());)e(t)},e.prototype.updateExposedBufferRanges=function(){try{this.bufferedRanges=s(this.buffer.buffered)}catch(e){}},e.prototype.onUpdateEnded=function(){var e=new n.Deferred;return this.pendingUpdateEndedPromises.enqueue(e),e.promise},e.prototype.queueAction=function(e){var t=this,r=this.queuePromise.then((function(){return t.ready()})).then((function(){return Promise.resolve(e()).then((function(){return t.ready()}))}));return this.queuePromise=r.catch((function(){})),r},e.prototype.changeType=function(e){this.buffer.changeType(e)},e.prototype.dispose=function(){var e=this;["error","abort","sourceended","sourceclose"].forEach((function(t){e.buffer.removeEventListener(t,e.onUpdateError)})),this.cleanUpPendingUpdateEndedPromises((function(e){return e.reject("disposing source buffer")})),this.buffer.removeEventListener("updateend",this.onUpdateSuccess)},e}();function s(e){for(var t=[],r=0;r<e.length;r++)t.push({start:e.start(r),end:e.end(r)});return t}t.SourceBufferWrapper=o},73729:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.TechnologyChecker=void 0;var n=r(8833),i=function(){function e(){}return e.prototype.getSupportedTechnologies=function(){return[{player:n.PlayerType.Html5,streaming:n.StreamType.Dash},{player:n.PlayerType.Html5,streaming:n.StreamType.Hls},{player:n.PlayerType.Html5,streaming:n.StreamType.Smooth}]},e}();t.TechnologyChecker=i},88074:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.VideoEventHandler=void 0;var r=function(){function e(e){var t=this;this.addTimeToEvent=function(e){return e.time=t.video&&t.video.currentTime||0,e},this.video=e}return e.prototype.on=function(e,t){this.video&&this.video.addEventListener(e,t,this.addTimeToEvent)},e.prototype.off=function(e,t){this.video&&this.video.removeEventListener(e,t)},e.prototype.fire=function(e,t){this.video&&this.video.eventHandler.triggerEvent(e,t)},e.prototype.dispose=function(){},e}();t.VideoEventHandler=r}},function(e){return function(t){return e(e.s=t)}(26463)}])}));
})();
